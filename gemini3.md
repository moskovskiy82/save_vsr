# –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π Systemair SAVE VSR

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞

**–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`example/systemair-main/`) - —ç—Ç–æ –∫–æ–¥ –¥—Ä—É–≥–æ–≥–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞.

### ‚úÖ –ß—Ç–æ –ú–û–ñ–ù–û:
- –ò–∑—É—á–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è
- –ü–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ —Ä–µ—à–∞—é—Ç—Å—è –ø—Ä–æ–±–ª–µ–º—ã
- –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö (ModbusParameter)
- –°–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (Energy sensor, API layer)

### ‚ùå –ß—Ç–æ –ù–ï–õ–¨–ó–Ø:
- –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ 1 –≤ 1
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏—è
- –ü–µ—Ä–µ–Ω–æ—Å–∏—Ç—å —Ü–µ–ª—ã–µ —Ñ–∞–π–ª—ã

### üéØ –ü–æ–¥—Ö–æ–¥:
**–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –ø–æ–¥ –Ω–∞—à–∏ –Ω—É–∂–¥—ã**, –∞ –Ω–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ.

---

## –î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞
2025-12-01

## –û–±–∑–æ—Ä

–ü—Ä–æ–≤–µ–¥–µ–Ω –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–≤—É—Ö –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ Systemair SAVE VSR:
1. **–í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`save_vsr`) - –±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
2. **–†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** (`example/systemair-main`) - –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

---

## 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è

### 1.1 –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```
save_vsr/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ climate.py
‚îú‚îÄ‚îÄ coordinator.py
‚îú‚îÄ‚îÄ const.py
‚îú‚îÄ‚îÄ hub.py
‚îú‚îÄ‚îÄ sensor.py
‚îú‚îÄ‚îÄ binary_sensor.py
‚îú‚îÄ‚îÄ number.py
‚îú‚îÄ‚îÄ select.py
‚îú‚îÄ‚îÄ switch.py
‚îî‚îÄ‚îÄ config_flow.py
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```
systemair/
‚îú‚îÄ‚îÄ __init__.py
‚îú‚îÄ‚îÄ api.py          # ‚≠ê –û—Ç–¥–µ–ª—å–Ω—ã–π API —Å–ª–æ–π
‚îú‚îÄ‚îÄ modbus.py       # ‚≠ê –ü–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
‚îú‚îÄ‚îÄ data.py         # ‚≠ê –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ entity.py       # ‚≠ê –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å—É—â–Ω–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ coordinator.py
‚îú‚îÄ‚îÄ climate.py
‚îú‚îÄ‚îÄ sensor.py
‚îú‚îÄ‚îÄ binary_sensor.py
‚îú‚îÄ‚îÄ button.py       # ‚≠ê –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
‚îú‚îÄ‚îÄ number.py
‚îú‚îÄ‚îÄ select.py
‚îú‚îÄ‚îÄ switch.py
‚îî‚îÄ‚îÄ config_flow.py
```

**–ö–ª—é—á–µ–≤—ã–µ –æ—Ç–ª–∏—á–∏—è:**
- ‚úÖ –†–µ—Ñ–µ—Ä–µ–Ω—Å –∏–º–µ–µ—Ç **–æ—Ç–¥–µ–ª—å–Ω—ã–π API —Å–ª–æ–π** (`api.py`) —Å 3 —Ç–∏–ø–∞–º–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
- ‚úÖ –ü–æ–ª–Ω–∞—è **–∫–∞—Ä—Ç–∞ Modbus —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤** (`modbus.py`) —Å 2457 —Å—Ç—Ä–æ–∫–∞–º–∏
- ‚úÖ **–¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** —á–µ—Ä–µ–∑ `@dataclass`
- ‚úÖ **–ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å —Å—É—â–Ω–æ—Å—Ç–µ–π** –¥–ª—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞

---

## 2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤

### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –¢–æ–ª—å–∫–æ 2 —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- Serial (RS485)
- Modbus TCP
```

### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# 3 —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ + –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- Serial (RS485) - AsyncModbusSerialClient
- Modbus TCP - AsyncModbusTcpClient  
- Web API - HTTP REST API (‚≠ê —É–Ω–∏–∫–∞–ª—å–Ω–æ!)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–∞:**
- ‚úÖ **Web API –∫–ª–∏–µ–Ω—Ç** - —Ä–∞–±–æ—Ç–∞ —á–µ—Ä–µ–∑ HTTP –±–µ–∑ Modbus
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ** –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (414 URI Too Long)
- ‚úÖ **Retry –ª–æ–≥–∏–∫–∞** —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
- ‚úÖ **Worker queue** –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

---

## 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ Modbus —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

### 3.1 –ö–∞—Ä—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# const.py - ~150 —Å—Ç—Ä–æ–∫, –±–∞–∑–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã
REG_MODE_MAIN_STATUS_IN = 1160
REG_MODE_MAIN_CMD = 1161
REG_TARGET_TEMP = 2000
# ... –æ–∫–æ–ª–æ 50 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# modbus.py - 2457 —Å—Ç—Ä–æ–∫, –ø–æ–ª–Ω–∞—è –∫–∞—Ä—Ç–∞!
@dataclass(kw_only=True, frozen=True)
class ModbusParameter:
    register: int
    sig: IntegerType  # UINT/INT
    reg_type: RegisterType  # Input/Holding
    short: str
    description: str
    min_value: int | None = None
    max_value: int | None = None
    boolean: bool | None = None
    scale_factor: int | None = None
    combine_with_32_bit: int | None = None

# 400+ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å –ø–æ–ª–Ω–æ–π –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π!
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–¢–∏–ø–∏–∑–∞—Ü–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤** (Input vs Holding)
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (scale_factor)
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ 32-bit –∑–Ω–∞—á–µ–Ω–∏–π** (combine_with_32_bit)
- ‚úÖ **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤** (min_value, max_value)
- ‚úÖ **Signed/Unsigned** –æ–±—Ä–∞–±–æ—Ç–∫–∞

### 3.2 –ß—Ç–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –ü—Ä–æ—Å—Ç–æ–µ —á—Ç–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏
descriptors = [
    (True, REG_MODE_MAIN_STATUS_IN, 1),
    (False, REG_MODE_SPEED, 1),
    # ...
]
# –ë–∞–∑–æ–≤–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –£–º–Ω–æ–µ —á—Ç–µ–Ω–∏–µ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
READ_BLOCKS = [
    (1001, 62),   # –ë–ª–æ–∫ 1: 62 —Ä–µ–≥–∏—Å—Ç—Ä–∞
    (1101, 80),   # –ë–ª–æ–∫ 2: 80 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
    (2001, 125),  # –ë–ª–æ–∫ 3: 125 —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤
    # ... 30+ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–æ–≤
]

# –î–ª—è Web API - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ
max_registers_per_request = 70  # –ò–∑–±–µ–≥–∞–µ–º 414 –æ—à–∏–±–∫–∏
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏** - –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–±–∏–µ–Ω–∏–µ** –¥–ª—è Web API
- ‚úÖ **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ** —á–µ—Ä–µ–∑ `asyncio.gather()`

---

## 4. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–∞–Ω–Ω—ã—Ö

### 4.1 –°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- Fast cycle: –∫–∞–∂–¥—ã–µ 10s (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- Slow cycle: –∫–∞–∂–¥—ã–µ 60s (–∞–ª–∞—Ä–º—ã)

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ failed_addrs
- –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π retry (180 —Ü–∏–∫–ª–æ–≤)
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –£–º–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
def register_modbus_parameters(self, param: ModbusParameter):
    """–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–ª—è —á—Ç–µ–Ω–∏—è (WebAPI)"""
    if param not in self.modbus_parameters:
        self.modbus_parameters.append(param)
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ 32-bit —Ä–µ–≥–∏—Å—Ç—Ä—ã
    if param.combine_with_32_bit:
        combine_with = find_param(param.combine_with_32_bit)
        if combine_with:
            self.modbus_parameters.append(combine_with)

# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —á—Ç–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤!
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:**
- ‚úÖ **–õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞** - —á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** - 32-bit —Ä–µ–≥–∏—Å—Ç—Ä—ã
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è Web API** - –º–∏–Ω–∏–º—É–º –∑–∞–ø—Ä–æ—Å–æ–≤

### 4.2 –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –†—É—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
def to_signed16(value: int) -> int:
    return value - 65536 if value > 32767 else value

data["temp_outdoor"] = round(to_signed16(t_oat[0]) * 0.1, 1)
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
def get_modbus_data(self, register: ModbusParameter) -> float | bool:
    value = self.data.get(str(register.register - 1))
    
    if register.boolean:
        return value != 0
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 32-bit
    if register.combine_with_32_bit:
        high = self.data.get(str(register.combine_with_32_bit - 1))
        value += int(high) << 16
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ signed
    if register.sig == IntegerType.INT and value > (1 << 15) - 1:
        value = -(65536 - value)
    
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
    return value / (register.scale_factor or 1)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **–î–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –≤—Å—ë –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫** - –Ω–µ—Ç —Ä—É—á–Ω–æ–≥–æ –∫–æ–¥–∞
- ‚úÖ **–õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å** - –¥–æ–±–∞–≤–∏–ª –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ —Å–ø–∏—Å–æ–∫

---

## 5. –°–µ–Ω—Å–æ—Ä—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 5.1 –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–Ω—Å–æ—Ä–æ–≤

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
Sensors: ~40
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã: 5
- –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã: 6
- –ú–æ—â–Ω–æ—Å—Ç—å: 4 (—Ä–∞—Å—á–µ—Ç–Ω—ã–µ)
- –ê–ª–∞—Ä–º—ã: 27
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: 3
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
Sensors: 60+
- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã: 8
- –í–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã: 10
- –ú–æ—â–Ω–æ—Å—Ç—å: 3 (—Å —ç–Ω–µ—Ä–≥–∏–µ–π!)
- –ê–ª–∞—Ä–º—ã: 16 (—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: 15+
- IAQ: 3 (–∫–∞—á–µ—Å—Ç–≤–æ –≤–æ–∑–¥—É—Ö–∞)
- –¢–∞–π–º–µ—Ä—ã: 5 (—Ü–∏—Ä–∫—É–ª—è—Ü–∏–æ–Ω–Ω—ã–µ –Ω–∞—Å–æ—Å—ã)
```

### 5.2 –≠–Ω–µ—Ä–≥–µ—Ç–∏—á–µ—Å–∫–∏–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –ü—Ä–æ—Å—Ç–æ–π —Ä–∞—Å—á–µ—Ç –º–æ—â–Ω–æ—Å—Ç–∏
class VSRSensor:
    if self.key == "supply_fan_power":
        supply_pct = data.get("fan_supply")
        return round((supply_pct / 100) * 160, 1)
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —ç–Ω–µ—Ä–≥–æ–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
class SystemairEnergySensor(RestoreSensor):
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Energy Dashboard"""
    
    def __init__(self, power_sensor: SystemairPowerSensor):
        self._power_sensor = power_sensor
        self._last_update: datetime | None = None
    
    async def async_added_to_hass(self):
        # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –ë–î
        last_data = await self.async_get_last_sensor_data()
        if last_data:
            self._attr_native_value = last_data.native_value
    
    def _handle_coordinator_update(self):
        # –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ—â–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏
        time_delta = now - self._last_update
        energy_kwh = (power_w / 1000) * (time_delta.total_seconds() / 3600)
        self._attr_native_value += energy_kwh

# –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MODEL_SPECS –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–∞—Å—á–µ—Ç–æ–≤
MODEL_SPECS = {
    "VSR 500": {
        "fan_power": 338,
        "heater_power": 1670,
        "supply_fans": 1,
        "extract_fans": 1
    },
    # ... 40+ –º–æ–¥–µ–ª–µ–π
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ **Energy Dashboard** - –ø–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞–º–∏
- ‚úÖ **–¢–æ—á–Ω—ã–µ —Ä–∞—Å—á–µ—Ç—ã** - –ø–æ –º–æ–¥–µ–ª–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
- ‚úÖ **–†–∞–∑–¥–µ–ª—å–Ω—ã–π —É—á–µ—Ç** - –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä—ã + –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å

---

## 6. Climate Entity

### 6.1 –ü—Ä–æ–±–ª–µ–º–∞ —Å preset modes

#### –í–∞—à–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: Offset –º–µ–∂–¥—É —á—Ç–µ–Ω–∏–µ–º –∏ –∑–∞–ø–∏—Å—å—é
PRESET_COMMAND_MAP = {  # –ó–∞–ø–∏—Å—å –≤ 1161
    "auto": 1,
    "manual": 2,
    "fireplace": 5,  # –ü–∏—à–µ–º 5
}

PRESET_STATUS_MAP = {  # –ß—Ç–µ–Ω–∏–µ –∏–∑ 1160
    0: "auto",
    1: "manual", 
    4: "fireplace",  # –ß–∏—Ç–∞–µ–º 4 (5-1)
}

# –†–µ—à–µ–Ω–∏–µ: offset -1
new["mode_main"] = val - 1  # Status = Command - 1
```

#### –†–µ—Ñ–µ—Ä–µ–Ω—Å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```python
# –≠–õ–ï–ì–ê–ù–¢–ù–û–ï –†–ï–®–ï–ù–ò–ï: –ï–¥–∏–Ω–∞—è –∫–∞—Ä—Ç–∞
PRESET_MODE_TO_VALUE_MAP = {
    "auto": 1,
    "manual": 2,
    "fireplace": 5,
}

# –û–±—Ä–∞—Ç–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å offset
VALUE_TO_PRESET_MODE_MAP = {
    value - 1: key  # ‚≠ê Offset –≤—Å—Ç—Ä–æ–µ–Ω –≤ –∫–∞—Ä—Ç—É!
    for key, value in PRESET_MODE_TO_VALUE_MAP.items()
}

# –ß—Ç–µ–Ω–∏–µ
mode = coordinator.get_modbus_data(parameter_map["REG_USERMODE_MODE"])
```

---

## 7. –ü–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π (Roadmap)

### –§–∞–∑–∞ 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —è–¥—Ä–∞ (Critical)
1. [ ] **–°–æ–∑–¥–∞—Ç—å `modbus.py`**: –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –≤—Å–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä—É `ModbusParameter`.
2. [ ] **–í–Ω–µ–¥—Ä–∏—Ç—å `api.py`**: –í—ã–¥–µ–ª–∏—Ç—å –ª–æ–≥–∏–∫—É –æ–±—â–µ–Ω–∏—è —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ–º –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–ª–∞—Å—Å.
3. [ ] **–û–±–Ω–æ–≤–∏—Ç—å `coordinator.py`**: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `ModbusParameter` –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.

### –§–∞–∑–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ (High)
1. [ ] **Energy Dashboard**: –î–æ–±–∞–≤–∏—Ç—å `SystemairEnergySensor` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –º–æ—â–Ω–æ—Å—Ç–∏ –≤–æ –≤—Ä–µ–º–µ–Ω–∏.
2. [ ] **Alarm History**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞—Ä—Å–∏–Ω–≥ –∂—É—Ä–Ω–∞–ª–∞ –æ—à–∏–±–æ–∫ (—Ä–µ–≥–∏—Å—Ç—Ä—ã 15000+).
3. [ ] **Filter Timer**: –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É —Å–±—Ä–æ—Å–∞ —Ç–∞–π–º–µ—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞ (–∑–∞–ø–∏—Å—å —Ç–µ–∫—É—â–µ–≥–æ timestamp).

### –§–∞–∑–∞ 3: ML –∏ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (Innovation)
1. [ ] **ML Anomaly Detection**:
   - –û–±—É—á–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è—Ö (RPM –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤ vs % –º–æ—â–Ω–æ—Å—Ç–∏).
   - –î–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞—Å–æ—Ä–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ *–¥–æ* —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è —à—Ç–∞—Ç–Ω–æ–≥–æ –¥–∞—Ç—á–∏–∫–∞ –¥–∞–≤–ª–µ–Ω–∏—è.
   - *–ò–¥–µ—è:* –ï—Å–ª–∏ –ø—Ä–∏ 50% –º–æ—â–Ω–æ—Å—Ç–∏ RPM –ø–∞–¥–∞–µ—Ç –Ω–∞ 10% -> —Ñ–∏–ª—å—Ç—Ä –∑–∞–±–∏–≤–∞–µ—Ç—Å—è.

2. [ ] **Predictive Defrosting**:
   - –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç—Ä–µ–Ω–¥ –ø–∞–¥–µ–Ω–∏—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Ç–µ–ø–ª–æ–æ–±–º–µ–Ω–Ω–∏–∫–∞.
   - –ü—Ä–µ–¥—Å–∫–∞–∑—ã–≤–∞—Ç—å –æ–±–º–µ—Ä–∑–∞–Ω–∏–µ –∏ –≤–∫–ª—é—á–∞—Ç—å "Soft Defrost" –∑–∞—Ä–∞–Ω–µ–µ, –∏–∑–±–µ–≥–∞—è –ø–æ–ª–Ω–æ–π –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏—Ç–æ–∫–∞.

3. [ ] **Smart CO2 Demand**:
   - –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞—Ç—á–∏–∫ CO2, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ML –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –ø–∏–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–µ—á–µ—Ä–æ–º).
   - –ó–∞—Ä–∞–Ω–µ–µ –ø–æ–≤—ã—à–∞—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ü–∏—é *–ø–µ—Ä–µ–¥* –ø—Ä–∏—Ö–æ–¥–æ–º –ª—é–¥–µ–π (Pre-cooling / Pre-ventilation).

4. [ ] **Virtual Sensors**:
   - –†–∞—Å—á–µ—Ç –ö–ü–î —Ä–µ–∫—É–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
     `Efficiency = (T_supply - T_outdoor) / (T_extract - T_outdoor)`
   - –í—ã–≤–æ–¥ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ –ö–ü–î –ø–∞–¥–∞–µ—Ç –Ω–∏–∂–µ 70% (–ø—Ä–æ–±–ª–µ–º–∞ —Å —Ä–æ—Ç–æ—Ä–æ–º).

---

## 8. –ü—Ä–æ—Å—Ç—ã–µ –∏–¥–µ–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (Quick Wins)

### 8.1 –£–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ CO2 (–±–µ–∑ ML)
–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –≤–Ω–µ—à–Ω–∏–µ –¥–∞—Ç—á–∏–∫–∏ CO2 –≤ Home Assistant:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è "–ì–æ—Å—Ç–∏"**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* CO2 > 1000 ppm.
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º `Crowded` (–∏–ª–∏ –ø–æ–≤—ã—Å–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤).
   - *–£—Å–ª–æ–≤–∏–µ:* –ù–µ –≤–∫–ª—é—á–∞—Ç—å –Ω–æ—á—å—é (—á—Ç–æ–±—ã –Ω–µ —à—É–º–µ—Ç—å).

2. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è "–ü—Ä–æ–≤–µ—Ç—Ä–∏–≤–∞–Ω–∏–µ"**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* CO2 > 800 ppm.
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º —Å `Eco` –Ω–∞ `Normal`.

### 8.2 –ö–æ–º—Ñ–æ—Ä—Ç –∏ –≠–∫–æ–Ω–æ–º–∏—è
1. **"–ù–∏–∫–æ–≥–æ –Ω–µ—Ç –¥–æ–º–∞"**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* –°—Ç–∞—Ç—É—Å –¥–æ–º–∞ `Away` (–ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤—Å–µ—Ö –∂–∏–ª—å—Ü–æ–≤).
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º `Away` –Ω–∞ –≤–µ–Ω—Ç–∏–ª—è—Ü–∏–∏ (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å).
   - *–≠–∫–æ–Ω–æ–º–∏—è:* –°—É—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –Ω–∞ –Ω–∞–≥—Ä–µ–≤–µ –ø—Ä–∏—Ç–æ—á–Ω–æ–≥–æ –≤–æ–∑–¥—É—Ö–∞ –∑–∏–º–æ–π.

2. **"–ù–æ—á–Ω–æ–π —Ä–µ–∂–∏–º"**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* –í—Ä–µ–º—è 23:00.
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä–æ–≤ –¥–æ 40% (—á—Ç–æ–±—ã –Ω–µ —à—É–º–µ–ª–æ).

3. **"–õ–µ—Ç–Ω–µ–µ –æ—Ö–ª–∞–∂–¥–µ–Ω–∏–µ" (Free Cooling)**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –Ω–∞ —É–ª–∏—Ü–µ < –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤ –¥–æ–º–µ (–Ω–æ—á—å—é –ª–µ—Ç–æ–º).
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –í–∫–ª—é—á–∏—Ç—å —Ä–µ–∂–∏–º `Free Cooling` (–±–∞–π–ø–∞—Å —Ä–µ–∫—É–ø–µ—Ä–∞—Ç–æ—Ä–∞), —á—Ç–æ–±—ã –æ—Ö–ª–∞–¥–∏—Ç—å –¥–æ–º –Ω–æ—á–Ω—ã–º –≤–æ–∑–¥—É—Ö–æ–º.

### 8.3 –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ
1. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ñ–∏–ª—å—Ç—Ä–∞—Ö**:
   - –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram/HA App, –∫–æ–≥–¥–∞ —Å–µ–Ω—Å–æ—Ä `filter_remaining_time` < 7 –¥–Ω–µ–π.

2. **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—ã–º–∞**:
   - *–¢—Ä–∏–≥–≥–µ—Ä:* –í–Ω–µ—à–Ω–∏–π –¥–∞—Ç—á–∏–∫ PM2.5 (–Ω–∞ —É–ª–∏—Ü–µ) > 50 (–¥—ã–º, –≥–∞—Ä—å).
   - *–î–µ–π—Å—Ç–≤–∏–µ:* –í—ã–∫–ª—é—á–∏—Ç—å –ø—Ä–∏—Ç–æ—á–Ω—ã–π –≤–µ–Ω—Ç–∏–ª—è—Ç–æ—Ä –∏–ª–∏ –ø–µ—Ä–µ–≤–µ—Å—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ—Ü–∏—Ä–∫—É–ª—è—Ü–∏–∏ (–µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è).

---

## 9. –ò—Ç–æ–≥–æ–≤—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥ 1-–≤-1**, –Ω–æ –∑–∞–±–µ—Ä–∏—Ç–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É `ModbusParameter`. –≠—Ç–æ —Ä–µ—à–∏—Ç 90% –ø—Ä–æ–±–ª–µ–º —Å –ø—É—Ç–∞–Ω–∏—Ü–µ–π —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤.
2. **–í–Ω–µ–¥—Ä–∏—Ç–µ `SystemairEnergySensor`** - —ç—Ç–æ "–∫–∏–ª–ª–µ—Ä-—Ñ–∏—á–∞" –¥–ª—è Home Assistant.
3. **–†–µ—à–∏—Ç–µ –ø—Ä–æ–±–ª–µ–º—É —Å Preset Offset** —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é –∫–∞—Ä—Ç—É —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–¥–≤–∏–≥–æ–º `-1` –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏.
